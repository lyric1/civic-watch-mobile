name: üß™ Test Notifications

on:
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Run in test mode (limited notifications)'
        required: false
        default: true
        type: boolean

jobs:
  test-notifications:
    runs-on: ubuntu-latest
    name: Test notification system
    environment: Dev
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        
      - name: üü¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: scripts/package.json
          
      - name: üì¶ Install dependencies
        run: |
          cd scripts
          npm install
          
      - name: üß™ Test notification service
        run: |
          cd scripts
          echo "üîî Testing notification service..."
          echo "‚öôÔ∏è Environment check:"
          echo "SUPABASE_URL: ${SUPABASE_URL:+SET}"
          echo "SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY:+SET}"
          echo "CONGRESS_API_KEY: ${CONGRESS_API_KEY:+SET}"
          echo "OPENSTATES_API_KEY: ${OPENSTATES_API_KEY:+SET}"
          echo ""
          echo "üöÄ Running notification check..."
          node notification-cron.js
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          CONGRESS_API_KEY: ${{ secrets.CONGRESS_API_KEY }}
          OPENSTATES_API_KEY: ${{ secrets.OPENSTATES_API_KEY }}
          TEST_MODE: ${{ inputs.test_mode }}
          
      - name: ‚úÖ Test completed
        run: echo "üéâ Notification test completed successfully!" 